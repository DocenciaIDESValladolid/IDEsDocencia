<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>OpenLayers Click Event Example</title>
        
        <link rel="stylesheet" href="OpenLayers-2.13.1/theme/default/style.css" type="text/css">
        <link rel="stylesheet" href="OpenLayers-2.13.1/examples/style.css" type="text/css">
        <script src="OpenLayers-2.13.1/OpenLayers.js"></script>
        <script type="text/javascript">
            OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {                
                defaultHandlerOptions: {
                    'single': true,
                    'double': false,
                    'pixelTolerance': 0,
                    'stopSingle': false,
                    'stopDouble': false
                },

                initialize: function(options) {
                    this.handlerOptions = OpenLayers.Util.extend(
                        {}, this.defaultHandlerOptions
                    );
                    OpenLayers.Control.prototype.initialize.apply(
                        this, arguments
                    ); 
                    this.handler = new OpenLayers.Handler.Click(
                        this, {
                            'click': this.trigger
                        }, this.handlerOptions
                    );
                }, 

                trigger: function(e) {
                    var lonlat = map.getLonLatFromPixel(e.xy);
                    alert("You clicked near " + lonlat.lat + " N, " +
                                              + lonlat.lon + " E");
                }

            });
            var map;
            function init(){
                map = new OpenLayers.Map('map',{displayProjection: new OpenLayers.Projection("EPSG: 4326"), Projection: new OpenLayers.Projection("EPSG: 4326")});
                
                //var osm = new OpenLayers.Layer.OSM();

                var gasolineras = new OpenLayers.Layer.WMS( "OpenLayers WMS",
                    "http://geoportalgasolineras.es/cgi-bin/mapserv?", {transparent:true,layers: "estaciones_servicio_95"},{isBaseLayer:false});
    var idee = new OpenLayers.Layer.WMS( "idee WMS",
                    "http://geoportalgasolineras.es/cgi-bin/mapserv?", {layers: "idee"},{isBaseLayer:true});

                map.addLayers([idee]);
                map.addControl(new OpenLayers.Control.LayerSwitcher());

                map.setCenter(
                    new OpenLayers.LonLat(-3, 40).transform(
                        new OpenLayers.Projection("EPSG:4326"),
                        map.getProjectionObject()
                    ), 
                    5
                );
                
                var click = new OpenLayers.Control.Click();
                map.addControl(click);
                click.activate();

               var radarStyle=  new OpenLayers.StyleMap({
                "default": new OpenLayers.Style({
                    pointRadius: 10, // sized according to type attribute
                    fillColor: "#ffcc66",
                    strokeColor: "#ff9933",
                    strokeWidth: 2,
                    graphicZIndex: 1
                }),
                "select": new OpenLayers.Style({
                    fillColor: "#66ccff",
                    strokeColor: "#3399ff",
                    graphicZIndex: 2
                })
            });
            
               var radares = new OpenLayers.Layer.Vector("WFS", {
                strategies: [new OpenLayers.Strategy.BBOX()],
                protocol: new OpenLayers.Protocol.WFS({
                    url:  "http://localhost/geoserver/wfs",
                    featureType: "interseccion_radares",
                    featureNS: "http://localhost:8080/geoserver/info_radar"
                }),
                styleMap: radarStyle,
//                filter: new OpenLayers.Filter.Logical({
//                    type: OpenLayers.Filter.Logical.OR,
//                    filters: [
//                        new OpenLayers.Filter.Comparison({
//                            type: OpenLayers.Filter.Comparison.EQUAL_TO,
//                            property: "TYPE",
//                            value: "highway"
//                        }),
//                        new OpenLayers.Filter.Comparison({
//                            type: OpenLayers.Filter.Comparison.EQUAL_TO,
//                            property: "TYPE",
//                            value: "road"
//                        })
//                    ]
//                })
            })
            map.addLayers([radares, gasolineras]);
            client = new OpenLayers.WPSClient({
                servers: {
                     cartociudad: 'http://localhost/wps'//'http://www.cartociudad.es/wps/WebProcessingService'
                }
            });

            var inicio = new OpenLayers.Geometry.Point(-3.8741284950823998, 40.3296855748486);
            
            var fin = new OpenLayers.Geometry.Point(-3.86769495662188, 40.3282382910204);

            var waypoints = new OpenLayers.Layer.Vector("Puntos");
            
            waypoints.addFeatures([inicio, fin]);

            // Create a process and configure it
            var ruta = client.getProcess('cartociudad', 'org.cnig.cartociudad.wps.RouteFinder');    
            ruta.execute({
                // spatial input can be a feature or a geometry or an array of
                // features or geometries
                inputs: {
                    a: waypoints
                },
                success: function(outputs) {
                 // outputs.result is a feature or an array of features for spatial
                // processes.
                    alert(outputs);
                }
            });
            }
        </script>
    </head>
    <body onload="init()">
        <h1 id="title">Click Event Example</h1>

        <div id="tags">
            click control, double, doubleclick, double-click, event, events, 
            propagation, light
        </div>

        <p id="shortdesc">
            This example shows the use of the click handler and 
            getLonLatFromPixel functions to trigger events on mouse click. 
        </p>

        <div id="map" class="smallmap"></div>
    
        <div id="docs">
            <p>Using the Click handler allows you to (for example) catch clicks 
            without catching double clicks, something that standard browser 
            events don't do for you. (Try double clicking: you'll zoom in, 
            whereas using the browser click event, you would just get two 
            alerts.) This example click control shows you how to use it.</p> 
        </div>
    </body>
</html>