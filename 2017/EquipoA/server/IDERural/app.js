/**
 * Demo functions
 */
setTimeout(function() {

  var demoFunctions=[
  //mostar las capas con los distintos tipos de zonas
  {title:'Paisajes Protegidos',function:'addWMSLayer(\'p_casas_rurales:paisajes_protegidos_esp,paisajes_protegidos_canarias\')'},
	{title:'Monumentos Naturales',function:'addWMSLayer(\'p_casas_rurales:monumentos_naturales_esp,monumentos_naturales_canarias\')'},
	{title:'Parques Nacionales',function:'addWMSLayer(\'p_casas_rurales:parques_nacionales_esp,parques_nacionales_canarias\')'},
	{title:'Parques Naturales',function:'addWMSLayer(\'p_casas_rurales:parques_naturales_esp,parques_naturales_canarias\')'},
	{title:'Reservas Naturales',function:'addWMSLayer(\'p_casas_rurales:reservas_naturales_esp,reservas_naturales_canarias\')'},
	{title:'Otros',function:'addWMSLayer(\'p_casas_rurales:otros_esp\')'},

  //{title:'GetFeature Provincia',function:'peticionPrueba(\'-4.83386,38.08648\')'},//NO FUNCIONA

  //WFS(0):Obtener la Feature de la provincia a partir de unas coordenadas(falta cogerlas con la banderita)
  {title:'GetFeature Provincia 2',function:'addWFSFeatureProvincia(-4.83386,41.58648)'},

  //WFS(1), hay que pasarle el riesgo máximo, usuario, y el codigo de la provincia, WFS(0)
   {title:'WFS Riesgos',function:'addWFSFeatureRiesgos(3,47)'},
  
   //WFS(2), hay que pasarle la distancia máxima, usuario, y la geometría de la provincia, WFS(0)
	{title:'WFS Distancias',function:'addWFSFeatureDistancias(9)'},

   //WPS(3), Intersect WFS(1) y WFS(2)
	{title:'WPS Intersect',function:'WPSIntersect(null)'},

  //WPS(4), pasar una features collection a geometry
  {title:'WPS Geometry',function:'WPSGeometry()'},
  

  //Muestra las provincias en el mapa de España(Estilo mal y no hace el zoom a la capa añadida) 
  {title:'Provincias',function:"addWMSLayer('p_casas_rurales:provincias')"},

  //Pruebas Hector
    //{title:'Estados',function:'addWMSLayer(\'prueba:Provincias_ETRS89_30N\')'},
    //{title:'add Editable layer',function:'addEditableLayer()'},
  ];

  //Para poder trabajar con el SRS EPSG:4258
  ol.proj.setProj4(proj4);
  proj4.defs("EPSG:4258","+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs");


  var liststring ='';
  demoFunctions.forEach(function(element) {
      liststring = liststring +  '<li><a href="#" onclick="'+element.function+'">'+ element.title +'</a></li>';
  }, this);
  var list = $('#listdemos');
  var listcontent = $(liststring);
  list.html(liststring);
  list.trigger('create');
  }, 100);

  //Ejemplo profesor
  function addEditableLayer(){
        var features = new ol.Collection();
        var featureOverlay = new ol.layer.Vector({
          source: new ol.source.Vector({features: features}),
          style: new ol.style.Style({
            fill: new ol.style.Fill({
              color: 'rgba(255, 255, 255, 0.2)'
            }),
            stroke: new ol.style.Stroke({
              color: '#ffcc33',
              width: 2
            }),
            image: new ol.style.Circle({
              radius: 7,
              fill: new ol.style.Fill({
                color: '#ffcc33'
              })
            })
          })
        });
        featureOverlay.setMap(map);

        var modify = new ol.interaction.Modify({
          features: features,
          // the SHIFT key must be pressed to delete vertices, so
          // that new vertices can be drawn at the same position
          // of existing vertices
          deleteCondition: function(event) {
            return ol.events.condition.shiftKeyOnly(event) &&
                ol.events.condition.singleClick(event);
          }
        });
        map.addInteraction(modify);

        var draw; // global so we can remove it later
        //TODO: use globals draw
        function activateDraw() {
          draw = new ol.interaction.Draw({
            features: features,
            type: /** @type {ol.geom.GeometryType} */ 'Polygon'
          });
          map.addInteraction(draw);
        }

        /**
         * Handle change event.
         */
        function deactivateDraw() {
          map.removeInteraction(draw);
        };   
        activateDraw();
  }

  //Ejemplo profesor
  function addWFSLayer() {
      var vectorSource = new ol.source.Vector({
          format: new ol.format.GeoJSON(),
          url: function (extent) {
              return 'https://ahocevar.com/geoserver/wfs?service=WFS&' +
                  'version=1.1.0&request=GetFeature&typename=osm:water_areas&' +
                  'outputFormat=application/json&srsname=EPSG:3857&' +
                  'bbox=' + extent.join(',') + ',EPSG:3857';
          },
          strategy: ol.loadingstrategy.bbox
      });
      var vector = new ol.layer.Vector({
          name: 'WFS example layer',
          source: vectorSource,
          style: new ol.style.Style({
              stroke: new ol.style.Stroke({
                  color: 'rgba(0, 0, 255, 1.0)',
                  width: 2
              })
          })
      });
      map.addLayer(vector);
      add_layer_to_list(vector);
  }


  //Para añadir las capas a la lista de capas.
  function addWMSLayer(nombre){
      var wms =new ol.layer.Image({
            //extent: [-13884991, 2870341, -7455066, 6338219],
            name: 'Provincias',
            source: new ol.source.ImageWMS({
              url: 'http://localhost:8081/geoserver/wms',
              params: {'LAYERS': nombre},
              serverType: 'geoserver'
            })
          });
      map.addLayer(wms);
      add_layer_to_list(wms);

      // GetFeatureInfo
      map.on('singleclick', function(evt) {
          var view = map.getView();
          var viewResolution = /** @type {number} */ (view.getResolution());
          var url = wms.getSource().getGetFeatureInfoUrl(
              evt.coordinate, viewResolution, 'EPSG:4258',
              {'INFO_FORMAT': 'text/plain'});
          if (url) {
              $.get(url,function(data){
                  create_popup('info','GetFeatureInfo',data);
              });
          }
        });
  }

  //Para añadir el mapa al inicio.
  function addWMSLayerInit(){
      var wms =new ol.layer.Image({
            //extent: [-13884991, 2870341, -7455066, 6338219],
            name: 'Provincias',
            source: new ol.source.ImageWMS({
              url: 'http://localhost:8081/geoserver/wms',
              params: {'LAYERS': 'p_casas_rurales:provincias',
                        'SRSName': 'EPSG:4258' },
              serverType: 'geoserver'
            })
          });
      map.addLayer(wms);
      add_layer_to_list(wms);
  }








  /***************************************************************/

  //WFS(0):Obtener la Feature de la provincia a partir de unas coordenadas
  function addWFSFeatureProvincia(coord,riesgoMax,distMax){
      var vectorSource = new ol.source.Vector();
        var vector = new ol.layer.Vector({
            name: 'GetFeature result',
          source: vectorSource,
          style: new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: 'rgba(0, 0, 0, 1.0)',
              width: 2
            })
          })
        });
        // generate a GetFeature request
        var coordenadas = new ol.geom.Point(coord);
        var featureRequest = new ol.format.WFS().writeGetFeature({
          srsName: 'EPSG:3857',
          featureNS: 'p_casas_rurales',
          featurePrefix: 'p_casas_rurales',
          featureTypes: ['provincias'],
          outputFormat: 'application/json',//'text/xml; subtype=gml/3.1.1',
          filter: ol.format.filter.intersects('the_geom', coordenadas,'EPSG:3857')
        });

        // then post the request and add the received features to a layer
        fetch('http://localhost:8081/geoserver/wfs', {
          method: 'POST',
          body: new XMLSerializer().serializeToString(featureRequest)
        })
        .then(function(response) {
        return response.json();
      }).then(function(json) {
        var features = new ol.format.GeoJSON().readFeatures(json);
        /*var the_geomProvincia = new ol.geom.Geometry();
        the_geomProvincia=response.getGeometry();*/     
          var cod_prov=features[0].get('codigo');
          var the_geom=features[0].getGeometry();
          vectorSource.addFeatures(features);
          map.addLayer(vector);
          add_layer_to_list(vector);
          //Para hacer zoom a la provincia
          map.getView().fit(vectorSource.getExtent());
      
          
          var featuresRiesgo=addWFSFeatureRiesgos(riesgoMax,cod_prov);
          console.log(featuresRiesgo);
          var featuresDistancia=addWFSFeatureDistancias(distMax,the_geom);
          console.log(featuresDistancia);
          var feautureIntersect=WPSIntersect(featuresRiesgo,featuresDistancia);
          //var geometry=WPSGeometry(feautureIntersect);
          //var feturesSuelo=WFSSuelo(geometry);
          //WPSIntersect(feturesSuelo,feautureIntersect);

        });
        
  }

  function addWFSFeatureRiesgos(riesgo,cod_prov){
      var vectorSource = new ol.source.Vector();
        var vector = new ol.layer.Vector({
            name: 'GetFeature riesgos',
          source: vectorSource,
          style: new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: 'rgba(0, 0, 0, 1.0)',
              width: 1
            }),
              fill: new ol.style.Fill({
              color: 'rgba(255, 0, 0, 1.0)'
            })
          })
        });
        // generate a GetFeature request
        var featureRequest = new ol.format.WFS().writeGetFeature({
          srsName: 'EPSG:3857',
          featureNS: 'p_casas_rurales',
          featurePrefix: 'p_casas_rurales',
          featureTypes: ['incendios_por_municipios'],
          outputFormat: 'application/json',
          filter: ol.format.filter.and(
            ol.format.filter.like('cod_prov', cod_prov),
            ol.format.filter.lessThan('total', riesgo)
          )
        });

        // then post the request and add the received features to a layer
        
          fetch('http://localhost:8081/geoserver/wfs', {
          method: 'POST',
          body: new XMLSerializer().serializeToString(featureRequest)
        }).then(function(response) {
          return response.json();
        }).then(function(json) {
          var features = new ol.format.GeoJSON().readFeatures(json);
          vectorSource.addFeatures(features);
          map.addLayer(vector);
          add_layer_to_list(vector);
          
        });
        return features;
  }

  function addWFSFeatureDistancias(distMax,the_geom){
      var vectorSource = new ol.source.Vector();
        var vector = new ol.layer.Vector({
            name: 'GetFeature distancias',
          source: vectorSource,
          style: new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: 'rgba(0, 255, 0, 1.0)',
              width: 2
              }),
          })
        });
        
        // generate a GetFeature request
        var featureRequest = new ol.format.WFS().writeGetFeature({
          srsName: 'EPSG:3857',
          featureNS: 'p_casas_rurales',
          featurePrefix: 'p_casas_rurales',
          featureTypes: ['distancias_zonas'],
          outputFormat: 'application/json',
          filter: ol.format.filter.and(
            ol.format.filter.greaterThan('distancia', distMax),
            ol.format.filter.intersects('the_geom', the_geom,'EPSG:3857')
            
          )
        });

        // then post the request and add the received features to a layer
        fetch('http://localhost:8081/geoserver/wfs', {
          method: 'POST',
          body: new XMLSerializer().serializeToString(featureRequest)
        }).then(function(response) {
          return response.json();
        }).then(function(json) {
          var features = new ol.format.GeoJSON().readFeatures(json);
          vectorSource.addFeatures(features);
          map.addLayer(vector);
          add_layer_to_list(vector);
          
        });
        return features;
  }

  function WPSIntersect(feature1,feature2){

  $.ajax({url:'http://localhost:8081/geoserver/wps',
  type:'post',
  data: getWPSRequest(feature1,feature2),
  contentType:'application/json; charset=utf-8',
  success:function(response, status, xhr){
     // WPS que queremos manejar como FeatureCollection
          response.json();
          var features = new ol.format.GeoJSON().readFeatures(json);
          vectorSource.addFeatures(features);
          map.addLayer(vector);
          add_layer_to_list(vector);
          console.log(features);
          return features;  
  }});
  
}

 function WPSGeometry(feautureIntersect){

  $.ajax({url:'http://localhost:8081/geoserver/wps',
  type:'post',
  data: getWPSTransform(feautureIntersect),
  contentType:"application/json; charset=utf-8",
  success:function(response, status, xhr){
    console.log(response);
    //WPS que devuelve Geometry
    var start=response.indexOf("<gml:Multipolygon>");
    var end=response.indexOf("</gml:Multipolygon>");
    var geomStr = responseStr.substring(start,end+19);
    console.log(geomStr);
  }});
    return geomStr;
      
  }

  function WFSSuelo(geometry){

      var vectorSource = new ol.source.Vector();
      var vector = new ol.layer.Vector({
          name: 'GetFeature distancias',
          source: vectorSource,
          style: new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: 'rgba(0, 0, 255, 1.0)',
              width: 2
              }),
          })
        });
        //geometría de la provincia obtenida en otra consulta
        var geom= new ol.geom.MultiPolygon([[[[-614119.8139002897,5174988.131379608],[-613416.3419002825,5174912.991179562],[-613395.0217002793,5174644.778979278],[-612086.3061002758,5173521.5502781235],[-611246.9600002734,5172240.030676764],[-610605.4219002681,5170905.56897534],[-610405.3696002675,5169944.551674302],[-609707.4121002596,5169440.991173792],[-610133.8363002673,5168835.8514731],[-608273.3389002535,5167519.581571753],[-607207.5119002478,5167075.1933713285],[-605430.7901002357,5165699.500469904],[-604519.8135002317,5166247.872970557],[-603883.0841002292,5166320.010270672],[-603528.5535002257,5165575.603369856],[-606406.0743002411,5163025.173566913],[-606447.3435002422,5162586.828666413],[-605922.9278002434,5162770.529166653],[-605175.1497002338,5162331.847166203],[-604626.8989002296,5161627.040665458],[-604850.7415002352,5159992.413563639],[-604856.5883002343,5158443.868061919],[-605386.5359002418,5156095.827559296],[-606361.0737002473,5156918.75126015],[-607376.8455002516,5157345.34296058],[-607893.7642002512,5157192.898660376],[-608152.224700257,5157304.103560483],[-608114.6255002568,5157632.878960855],[-608581.6702002594,5157708.389760907],[-610565.6712002713,5158667.653061855],[-610966.6799002757,5160310.937463649],[-610487.220800267,5160415.2922637975],[-609929.1216002617,5160868.612964323],[-609858.7254002661,5161642.317065183],[-609110.0138002563,5161921.7355655385],[-609075.3604002594,5162492.102066169],[-609230.1886002593,5163013.820766733],[-610884.609600267,5164853.532668678],[-610950.881300268,5165469.713169347],[-611445.4081002725,5165968.134269869],[-610755.284900265,5166794.117170818],[-611794.7865002742,5167808.542971869],[-611836.1373002726,5168351.387372472],[-613119.4653002828,5169597.662673758],[-612576.5230002778,5170353.591974621],[-612433.8110002764,5170949.25347528],[-613264.2833002841,5172523.838376955],[-614304.6590002909,5173674.998978153],[-614255.4151002889,5174563.971379129],[-614582.9784002879,5175541.850880183],[-614119.8139002897,5174988.131379608]]],[[[-592449.1458001588,5201168.770509088],[-592255.271500159,5201087.375909012],[-590710.1343001551,5201748.645209783],[-590189.0403001531,5201395.66450942],[-590069.3971001552,5200812.320808799],[-590430.6543001552,5199544.122507431],[-590363.4287001552,5198802.364806623],[-590671.6068001535,5198421.545506209],[-590798.2052001597,5198412.683106188],[-591000.7533001563,5198817.542606621],[-591859.4025001582,5198435.229906172],[-591823.6823001604,5197167.278704812],[-593032.2015001609,5196807.865204367],[-593648.6928001667,5196805.8304043375],[-594029.4208001676,5196026.264103485],[-593956.2497001701,5195619.383903056],[-594124.8466001678,5195618.801903046],[-594592.7617001717,5195907.836803333],[-594509.9307001714,5198006.290505598],[-595118.8252001746,5198658.5005062735],[-595180.8292001737,5199098.316006742],[-595117.5006001733,5199593.087107279],[-595244.4178001751,5199890.272507601],[-595048.2034001714,5200411.795708161],[-595040.8093001763,5201174.671508984],[-594598.1298001693,5201323.72970916],[-594133.5611001643,5201462.53280933],[-593166.5263001606,5202134.0228100885],[-592449.1458001588,5201168.770509088]]],[[[-569065.4965000806,5207806.8582169805],[-568796.6752000817,5207805.418816983],[-568707.1791000769,5207627.3425167985],[-567034.0989000738,5207423.452216623],[-566288.3170000741,5205645.829414739],[-566189.3385000767,5204855.409613884],[-565770.8229000758,5205079.827014142],[-565268.8751000748,5204761.470313813],[-565389.0256000734,5204483.414413515],[-564993.6121000719,5203769.455412752],[-565105.6701000708,5203436.076912397],[-564963.114500074,5202847.4328117715],[-564598.7445000693,5202685.613911602],[-564468.6490000671,5202887.9691118235],[-563957.0287000684,5202442.482211365],[-563520.3850000688,5202696.9927116465],[-563973.045700067,5200984.330409788],[-563874.9773000658,5200891.884309695],[-564188.5580000659,5200185.245108927],[-562698.8043000653,5199633.574708369],[-561708.7835000661,5200219.641109026],[-561228.7894000587,5201142.894210019],[-561310.3436000625,5201731.610010652],[-560931.5473000605,5202601.067211589],[-560710.8823000642,5204386.90771352],[-561221.1082000571,5204945.190714104],[-560866.5537000619,5205592.069414803],[-559526.5133000587,5205288.062414507],[-558829.0654000595,5204917.099614126],[-557185.3027000544,5204610.537413829],[-556835.7857000562,5204388.409513605],[-557257.1304000512,5203184.606312304],[-557287.8410000548,5202307.235311351],[-557701.0648000584,5200994.139309944],[-557561.5173000532,5200225.286109118],[-558439.3879000514,5199850.916008698],[-558691.1433000558,5199082.355707865],[-558323.4431000599,5198254.097606972],[-557596.171000057,5197336.908806004],[-557750.8249000545,5196397.546704998],[-557617.2154000506,5195649.233504186],[-557748.5634000578,5195211.524703709],[-559343.3842000561,5193975.503102344],[-559369.2103000578,5193585.025401917],[-558866.4650000553,5191829.288800037],[-558038.787200056,5190178.965398272],[-558217.8356000548,5189996.108798062],[-557977.0743000528,5189447.042197471],[-558790.9041000619,5187773.06229565],[-560147.9236000574,5187023.728194813],[-559495.8507000589,5185667.725393348],[-559599.3303000623,5184062.628291598],[-558270.2717000525,5184495.877292097],[-558300.0131000569,5184042.1332915975],[-557547.6665000566,5183272.925790781],[-557243.705800054,5183409.909090939],[-556864.8226000525,5183339.061990858],[-556506.9932000539,5182958.057990451],[-556053.2920000512,5183144.497590671],[-555963.6836000521,5182709.846290199],[-555504.7187000497,5182785.507690288],[-555315.2390000543,5182631.744790127],[-554510.1345000507,5183002.095790537],[-554623.4259000542,5183298.294190863],[-554360.3128000502,5183630.30919123],[-552856.884000045,5184340.006092024],[-552772.2974000454,5183707.728491345],[-552557.1935000449,5183669.427191296],[-552416.6580000479,5183415.751891032],[-552249.5778000413,5183708.982891354],[-550390.3098000438,5183886.9166915715],[-549761.1343000454,5183649.76399133],[-548526.5058000388,5183507.449491194],[-548782.3858000421,5182665.984190273],[-548692.9451000368,5180549.472287965],[-548257.0976000406,5179075.147086369],[-548661.1422000399,5178718.634985975],[-548166.3702000403,5177554.040584712],[-547713.8516000401,5175445.480082407],[-546816.0613000377,5174664.514981569],[-547449.6970000386,5174589.459981478],[-545930.4773000327,5172729.648379461],[-547331.1175000407,5172717.128979428],[-548554.3155000394,5171995.265778613],[-550767.148600042,5169118.46357542],[-550998.0589000453,5168624.418674878],[-549710.2776000408,5163957.727569753],[-549473.7391000405,5163663.515769427],[-552761.3531000486,5162036.529067581],[-553231.5850000496,5160618.527466005],[-553287.1925000512,5160757.548066155],[-553869.5174000516,5160012.91286532],[-553423.8199000482,5159331.239264574],[-553937.9698000484,5157027.909862014],[-554707.1108000568,5156473.36136138],[-554734.9204000517,5155989.979160839],[-554986.6712000526,5155780.520760613],[-555281.2635000538,5155797.936060621],[-555937.7452000584,5155374.061460147],[-556083.0301000536,5154688.453259371],[-556613.6510000557,5153651.448458209],[-556871.4817000591,5153188.428357701],[-557165.7045000598,5153077.724057563],[-556764.9395000591,5152476.520356909],[-556809.0162000534,5152119.6432565125],[-557137.366000057,5151688.728356022],[-556301.5875000567,5150333.681754533],[-555488.5617000542,5149836.550253992],[-555161.3023000506,5149268.803653363],[-555141.9413000565,5148022.943451971],[-554963.4928000523,5147618.88615153],[-554781.1614000535,5147511.303751415],[-554715.1125000527,5147790.363851724],[-553976.0375000559,5148045.967052024],[-553899.8023000527,5148701.173152757],[-554081.5640000515,5148783.197552841],[-553624.0514000496,5149028.224553121],[-553471.0163000511,5148910.4992529955],[-552927.980200047,5149701.853453893],[-551832.6879000447,5150241.780654507],[-551637.0533000503,5150672.103154994],[-550985.5377000452,5151072.442055452],[-550259.687400041,5150680.64555502],[-550148.6297000434,5150459.471254775],[-549077.6101000407,5149998.649454271],[-548590.1207000449,5148853.537053012],[-548812.7982000405,5148607.32095274],[-548575.4732000412,5148259.691952351],[-547317.6941000379,5148680.078652838],[-547222.4012000412,5148439.690352573],[-546778.8668000358,5148353.973252486],[-545448.5582000358,5150236.409654599],[-544327.6528000373,5150916.240455377],[-542566.8927000359,5150955.054455445],[-542024.1855000294,5150758.061355232],[-542050.2181000324,5149484.034353817],[-541869.5529000328,5148644.501252876],[-541349.5754000256,5148746.139553002],[-541075.7975000291,5148625.451752877],[-540919.1528000322,5148271.820252476],[-540560.9768000272,5148344.283652565],[-540779.7924000279,5147971.715852151],[-540578.7169000263,5147984.173052168],[-538593.633400025,5145792.223149737],[-537947.0651000263,5144039.04714779],[-537938.7403000259,5143080.414546715],[-537595.7804000287,5142282.536145826],[-536882.1650000243,5141143.913244555],[-535872.8889000244,5140478.781543822],[-535417.5786000263,5139490.928242724],[-535130.5543000249,5138274.8217413565],[-534541.550700025,5137232.109140192],[-534244.3142000233,5136160.457738993],[-533830.7881000255,5135551.531138306],[-533598.2251000206,5134360.292736968],[-533101.0720000232,5133979.201936541],[-533136.7240000229,5133759.168736295],[-531003.8390000201,5134520.589037177],[-530908.9969000204,5134928.8662376385],[-529705.0506000194,5134918.706337637],[-529364.6783000149,5135911.9629387595],[-528551.3985000135,5137124.91904013],[-526144.9141000152,5139211.507842496],[-526797.0397000165,5140296.768443711],[-526701.8585000131,5140833.151144324],[-526346.0655000134,5141350.6052449],[-525126.9840000109,5142169.549445832],[-523323.4240000118,5144109.712648022],[-521543.4918000069,5144756.41164876],[-520742.279900009,5145713.657449832],[-520794.66280000674,5145991.462250144],[-519826.2335000096,5146087.213750256],[-519279.71060000773,5145932.188150082],[-518574.2073000063,5145535.077349646],[-518550.3610000088,5145202.846049282],[-517803.4668000087,5144741.864748769],[-516956.013100007,5144702.98374873],[-516521.8540000058,5144452.734148456],[-516467.0107000039,5144250.417648224],[-516222.4857000039,5144233.554348206],[-515934.7188000034,5143422.957847314],[-516132.54900000157,5142889.948746702],[-515822.5184000078,5142388.231146148],[-515966.0412000054,5141679.937345353],[-515807.13610000827,5141647.970845317],[-515628.10360000364,5141260.940044887],[-515357.27250000945,5141267.449944896],[-515675.80960000434,5140804.968244371],[-515620.4360000038,5140289.071743799],[-515009.74970000074,5139768.958343216],[-515072.4939000092,5139611.615543035],[-514748.2900000052,5139131.835842509],[-514124.51370000775,5138836.757642175],[-513584.86990000197,5138305.867341582],[-513058.2100000065,5137389.823940559],[-512491.53530000814,5136839.269939943],[-511073.3393000026,5136565.6536396425],[-510267.2788000046,5134651.05223749],[-508294.0296999996,5132945.169135579],[-508428.58370000584,5133491.5664361995],[-508134.171500006,5133811.742336554],[-506872.6353999997,5133497.046136208],[-506288.86550000083,5133903.138336671],[-506002.35130000097,5134968.496037876],[-506520.3204000027,5135372.197238328],[-506409.57229999977,5135699.82753869],[-506028.3449000008,5135671.737738667],[-505817.97239999607,5135452.17553842],[-504218.5169999978,5135214.471738163],[-503270.76089999586,5134529.025137392],[-502287.23609999864,5134547.785937417],[-502013.62459999695,5134691.193837585],[-501947.79950000177,5134989.698637913],[-501559.20679999824,5135074.5808380125],[-501528.55790000246,5135546.062438548],[-501893.9050999977,5135893.514638938],[-501346.3115000031,5135857.402838903],[-500874.699499997,5136027.142239098],[-500034.1847999966,5136804.8345399685],[-499232.95939999545,5136912.97164009],[-498641.9695000013,5136772.479039943],[-498534.46249999653,5137540.091940807],[-498190.6254999981,5137505.645740763],[-498220.4755999988,5137369.200240606],[-497965.1803999936,5137494.730240755],[-497786.4557999996,5136999.855940196],[-498058.7617999934,5136066.633139143],[-497969.33390000043,5135854.219738911],[-498523.5247000021,5135337.383738318],[-496612.6012,5134108.153936945],[-497131.29720000224,5133949.94913677],[-497436.2606000011,5134149.227136993],[-498044.78939999524,5133836.065836627],[-498616.4915999998,5133800.644236592],[-499118.9809999952,5134105.416836934],[-499528.49089999666,5134068.7149368925],[-500231.3400000003,5128134.692930188],[-500091.655900003,5127880.323729899],[-501069.4173000017,5126798.468328671],[-500606.9435999964,5126619.693728468],[-499227.0663000002,5126518.677128353],[-497388.5617999962,5125591.905227308],[-495379.4770999972,5124851.8839264875],[-494626.8124999988,5124844.431526479],[-493588.2706999982,5125361.865927073],[-492189.769099997,5126309.974928153],[-490246.85579999245,5128554.946530697],[-489244.3859999947,5128856.378031047],[-488614.27469999855,5129241.777131476],[-487615.7812999968,5129045.462331271],[-487870.438499992,5128635.276130801],[-487733.20559999824,5128430.423230562],[-484676.91859999707,5127183.113829157],[-483604.5649999984,5126955.325228907],[-483305.7559999948,5127032.614428994],[-482895.27279999375,5126818.551928755],[-482442.63419999357,5126908.965328864],[-482138.7720999935,5126484.850628375],[-481554.4588999947,5126285.545228152],[-480637.48869999277,5125610.112227392],[-480676.5177999951,5126237.263028103],[-480404.03229999467,5126547.948728453],[-480170.3909999895,5126508.513828413],[-479429.62479999167,5127473.004829501],[-479121.4989999932,5127557.022229594],[-477748.3040999932,5127269.958129276],[-477179.7763999953,5127317.508729336],[-476307.3249999938,5129364.899931648],[-475298.373099998,5130081.876932474],[-474247.0286999964,5131852.547934466],[-473801.88189999195,5132019.155734654],[-472822.90949999326,5131504.866734077],[-471586.88469999575,5132776.427235509],[-471552.08629999624,5133153.588635942],[-471058.65109998983,5132103.398134753],[-470851.0119999913,5132109.074434765],[-470624.535299995,5131825.830534443],[-469094.38109999447,5130978.778333492],[-467131.150899992,5131637.212034234],[-466919.8734999955,5131669.751734267],[-466468.7169999913,5131311.534533869],[-465184.8508999938,5131592.919834188],[-464232.0879999923,5131096.236733627],[-463479.8171999917,5131253.084233811],[-462405.8635999941,5130502.352732957],[-462057.41959998786,5130898.4072334105],[-458992.0221999886,5132159.014934833],[-458402.1901999944,5131108.200533643],[-457562.7746999904,5130226.111532658],[-457369.9690999933,5128878.498831137],[-456872.0668999936,5128283.896330456],[-456440.16439999157,5127291.833729335],[-456033.1669999892,5127306.460029352],[-455195.7216999906,5128025.669530177],[-454605.6800999933,5127866.432029986],[-453251.5097999875,5126681.55862865],[-452410.97309998865,5126618.075128571],[-452397.11999999144,5126907.2863289025],[-452119.27639998944,5127295.220529346],[-451445.42189999326,5127174.470829203],[-450643.91349999286,5126576.6557285255],[-449828.1445999894,5126343.26702826],[-450229.5989999897,5126205.309728109],[-450797.5066999941,5126320.704628238],[-451148.62069999403,5125019.275726766],[-451487.98689999216,5122214.412823578],[-452300.4272999883,5121984.021123315],[-452969.47939999646,5122286.101923656],[-453777.03109999245,5121342.165222592],[-453583.413299994,5120518.327721645],[-453778.1855999969,5120036.279921103],[-452860.90039999277,5120105.511321183],[-451990.14799999056,5119385.519720363],[-451171.2024999915,5119063.805219993],[-450774.0526999929,5118427.953119269],[-449959.5787999906,5117799.886718558],[-448827.7937999935,5115799.13571628],[-448176.30259999156,5115010.6884153765],[-448201.2033999945,5113612.742113779],[-447930.5342999942,5111873.55811179],[-448032.4964999949,5110432.189610137],[-448309.26749999024,5109755.188509372],[-448657.8497999927,5105788.966104816],[-449161.0748999914,5105066.625703978],[-449205.60799999256,5104318.993403116],[-448474.39209999284,5103392.984002057],[-447794.53169999033,5103637.135202342],[-447258.2823999964,5104280.552403084],[-446580.29309998854,5103777.5637024995],[-445937.6943999961,5104131.115202906],[-445625.29969999444,5103808.841202541],[-445647.2191999912,5103624.859202329],[-445826.4204999936,5103292.86010195],[-446221.51249999483,5103029.41000164],[-446250.23929999134,5102742.093501302],[-444483.0197999921,5102537.34180107],[-444436.9452999974,5101313.620699666],[-444174.3266999896,5101009.597199313],[-443713.72449999035,5101030.975899344],[-443542.30839999125,5100874.719599157],[-443565.1519999916,5099592.773897688],[-443446.7138999916,5099159.779897179],[-443125.82719999214,5098773.354396735],[-443130.9743999912,5097457.035595211],[-443383.04879999306,5097077.549794781],[-443659.5791999948,5096031.733193576],[-444594.9334999933,5094702.422092029],[-444577.6460999919,5090978.337987705],[-444809.07699998986,5089517.152386017],[-445180.35739999363,5088853.984385249],[-445889.75169999304,5088709.148285074],[-446017.65399999387,5088924.593085326],[-446428.89519999136,5088724.265885098],[-446551.9918999911,5088983.956485395],[-446810.6410999961,5089084.030885518],[-448328.1031999944,5089019.183085438],[-449333.43829998834,5087852.864284073],[-450029.4200999954,5087824.379384038],[-450682.3415999913,5087544.640883725],[-451028.66609999264,5086842.851682902],[-451564.2387999922,5086462.768982458],[-451738.34499999083,5085974.658981893],[-452544.54919999203,5085592.566381446],[-454034.09029999544,5085690.492881558],[-455847.7095999958,5084833.628980559],[-457378.5252999939,5083887.7873794595],[-460255.9836999923,5083071.364478506],[-460473.1351999961,5082956.0834783735],[-461139.29169999587,5081906.110077136],[-462901.75549999566,5083713.343079242],[-463981.7280999919,5082816.786178202],[-465130.95769999136,5082716.805578083],[-467259.3313999933,5082078.548377332],[-470640.8147999955,5080425.251575386],[-471270.3639999924,5079796.795974656],[-472431.34809999325,5080641.730175648],[-472911.28649999236,5080740.487975761],[-474212.11949999206,5079902.72887478],[-474343.44959999353,5079032.565673765],[-474781.13079999364,5079986.7049748795],[-475348.82859999494,5080619.22417561],[-475796.008199993,5080117.578575027],[-476811.0208999916,5080255.037375189],[-477316.2565999958,5080169.896375082],[-477670.3632999964,5079690.987174524],[-478022.1260999932,5079684.372974517],[-478678.62429999124,5080091.90697499],[-480176.24049999216,5079703.95577453],[-480813.28349999595,5079437.360174217],[-480947.54549999186,5078711.5674733715],[-481757.0779999974,5078313.882172908],[-481774.8832999909,5078170.477272733],[-482200.41219999595,5078198.694772766],[-482842.51719999633,5078792.042373467],[-483870.6386999957,5078659.651173299],[-484066.7977999967,5079020.440973721],[-485117.94159999344,5078826.0148735],[-485619.39649999747,5078934.49037363],[-485503.2184999974,5078152.437772712],[-485901.52519999637,5077294.111271697],[-485900.147499994,5076866.132071197],[-486232.7593999955,5077343.69677176],[-486788.52559999854,5077266.646471668],[-487224.7039999967,5077717.127372187],[-487484.1621999963,5077692.913772164],[-487697.99659999384,5077228.043271617],[-488534.3126999985,5077532.937871968],[-488530.8990999938,5077318.988271721],[-488795.78789999615,5077135.491671504],[-489114.33509999316,5077141.048371516],[-489140.02209999505,5077413.491971833],[-490987.5614999987,5077704.432772168],[-491785.66739999515,5077291.418371671],[-491909.265199999,5077435.171871837],[-492655.6342999976,5076389.0089706145],[-493300.59339999553,5076477.2891707225],[-493354.84089999733,5076130.003270307],[-493683.96790000086,5076052.315570222],[-493209.88969999907,5075822.153369945],[-493277.1431999946,5075699.344469806],[-494606.58719999605,5075531.420569607],[-494636.51570000174,5075327.645469365],[-495308.2690999945,5075188.0142691955],[-495399.3009999966,5074975.207068949],[-495708.23289999715,5075047.556469035],[-495758.34059999854,5074697.713968625],[-495880.73129999987,5074767.855768704],[-495990.3034999996,5074549.390968449],[-496168.229299999,5074753.644268691],[-496892.9567000019,5074361.625468227],[-496768.70739999786,5074022.780667833],[-497146.4552999989,5073990.960567786],[-497132.97560000094,5073664.950767414],[-497393.28439999715,5073462.655167165],[-497973.5836999981,5073516.929767228],[-498089.6869999966,5073294.343466966],[-498404.54669999925,5073247.509266917],[-499019.434699999,5073299.7958669765],[-499236.4453999985,5073060.765766694],[-499120.064800002,5072874.260466468],[-499416.23900000105,5072826.380366416],[-499812.8311999995,5073042.795066664],[-500416.8710999989,5073006.946466621],[-500398.0500000023,5073229.198266888],[-500717.697599997,5073306.546166968],[-500942.34070000023,5073590.08946731],[-501138.2477999997,5073133.448566762],[-502602.85490000277,5072955.427266551],[-502774.3818999992,5072786.637266354],[-502533.43250000407,5072409.864765913],[-502714.7226000008,5071731.607065122],[-502638.5482000042,5070644.9018638395],[-499156.8295000017,5066596.257459083],[-499156.6004000004,5066426.576458883],[-500481.7926000009,5066169.912758572],[-500635.80280000105,5065606.150657908],[-500943.49139999715,5065236.118757474],[-500875.3637999977,5064602.794556731],[-500602.6957999995,5064377.77285646],[-500569.0712000002,5064047.1019560695],[-500874.154699997,5063682.516855629],[-500916.5117999973,5064133.236356173],[-501435.7545999996,5063688.773655644],[-501194.0994000018,5063640.896955593],[-501187.67639999907,5063037.321254873],[-500652.3958999989,5061928.832553567],[-500259.88650000154,5060606.993152002],[-498965.0393999999,5060570.5511519695],[-498508.6501999947,5060169.804451492],[-498030.8086999995,5059992.383751287],[-497659.5014999969,5059428.626050617],[-497351.74779999733,5056083.443946653],[-497761.05330000055,5055442.574945886],[-498898.289,5055944.956346484],[-499005.38669999794,5056300.797446904],[-499856.70190000226,5056868.069047576],[-500204.13969999785,5056814.022847503],[-500512.65450000204,5057048.938647779],[-500944.9763000015,5056827.8955475185],[-501536.6493000001,5058365.976049344],[-502188.82380000333,5058628.25134965],[-503640.6433000045,5059669.423350873],[-504124.74650000106,5059819.748151055],[-504725.18490000465,5059551.431950728],[-505259.01410000434,5058676.862949692],[-505789.6148000019,5058525.90334951],[-507565.81800000125,5057013.705447711],[-507875.69450000307,5057165.604247888],[-508203.0488000044,5057106.295247814],[-509190.68560000474,5057678.324848484],[-510588.485600002,5059225.2790503185],[-511719.12850000244,5059743.810950923],[-512044.1636000092,5059119.680550182],[-512643.10070000624,5058640.003749604],[-512177.20010000886,5057819.69014864],[-512290.0481000064,5057086.148747765],[-511599.1532000079,5056534.360847114],[-510979.2992000069,5055499.4772458915],[-509903.0629000019,5054946.723045239],[-509456.7277000033,5054450.470144654],[-509319.1889000034,5053680.413043736],[-509467.62990000384,5053289.450743273],[-509162.36250000587,5053018.828742949],[-509441.5241000007,5052728.241842605],[-510457.06500000984,5052297.447542096],[-510720.6512000032,5052321.954242112],[-511922.15090000397,5051384.717540985],[-512516.2077000049,5050159.909539528],[-512436.77900000673,5049886.6279392],[-513758.54900000326,5048008.341036957],[-514734.1740000047,5046968.6935357135],[-515310.5840000053,5046752.537435451],[-516217.0257000065,5045934.159934463],[-517392.6501000099,5045454.592733879],[-517731.73690001376,5045056.1999333985],[-517545.37980001135,5044822.465633124],[-517652.79050001345,5044673.788532944],[-517464.2102000117,5044392.114032614],[-517469.97100001195,5043853.491231971],[-517240.61660001223,5043239.40513123],[-517705.2474000148,5041901.821429627],[-517121.15700000885,5041481.16522912],[-516818.7007000087,5040999.183828555],[-516570.90460000595,5040951.912128497],[-516340.04840001033,5040392.637027826],[-516116.34480000805,5040496.791927952],[-515623.8502000129,5039642.686326933],[-515636.62620001077,5039332.013626566],[-515233.7117000072,5038437.672225486],[-515159.0841000112,5037566.52782444],[-515875.20770001115,5037188.085123982],[-516933.7205000093,5037168.081223951],[-517937.6579000139,5037769.717124666],[-519407.11820001487,5038976.514626102],[-521037.68900001165,5039776.394427057],[-521310.14930001367,5039588.569426824],[-521469.2333000171,5039028.58852616],[-523462.10470001725,5038115.732425045],[-524197.87970001565,5036992.991723679],[-525576.7378000143,5035521.962821905],[-525661.8992000212,5034390.996720549],[-526430.2433000143,5034606.075220805],[-527364.4172000183,5034552.786520728],[-527560.4641000164,5034338.458720463],[-528647.8774000197,5034453.745820594],[-530668.6909000267,5033362.200619259],[-531149.1218000241,5033637.332219594],[-531968.5453000255,5033752.385619723],[-532795.8845000295,5033539.649919451],[-533109.7719000251,5032997.936918796],[-533902.4091000239,5032391.757318057],[-534984.041700031,5032298.737117935],[-535838.9756000316,5031443.542816896],[-535699.7762000284,5030997.846016364],[-535824.3782000315,5030356.310215582],[-536231.2316000304,5029579.820014648],[-536286.4707000282,5028537.9012133805],[-536437.5069000293,5028277.8913130695],[-535999.473700035,5027612.377312265],[-537445.7247000299,5026977.921611483],[-539516.317900036,5027172.279711689],[-540256.4594000332,5027070.022511566],[-540517.9217000349,5027210.801011725],[-541422.0363000409,5026218.794010522],[-542360.7369000418,5026790.6901111975],[-542421.7820000397,5026979.6469114255],[-542153.5253000417,5027142.443611622],[-542322.1288000412,5027154.773311635],[-542634.1853000403,5027613.773912188],[-543121.2470000412,5027886.681112516],[-543343.9554000426,5027763.424512359],[-544327.2103000411,5028483.30221322],[-544809.984100044,5029043.705213879],[-545674.7991000466,5029244.387614119],[-546023.8732000487,5029870.260014867],[-546469.4826000435,5029875.110914876],[-548117.8570000514,5030669.270315807],[-548918.293500052,5031427.537616694],[-550008.645700057,5031917.060417273],[-550490.7368000534,5032662.440518168],[-551121.6206000566,5033118.265318707],[-552124.3064000588,5032820.057818325],[-552475.2035000557,5033030.4714185875],[-552666.3908000573,5034454.840120286],[-552991.9325000601,5034832.306720736],[-554076.0894000599,5034670.483320521],[-554876.8232000598,5034822.642020697],[-554657.556000065,5035215.178121168],[-555230.3695000664,5035376.516421355],[-555454.8877000661,5036089.193122209],[-557092.3997000671,5035811.754721847],[-557383.163600072,5035994.143122053],[-557431.7104000683,5036259.38322237],[-557815.1979000742,5036261.150322369],[-558140.0840000692,5036598.55942277],[-558146.3789000682,5036296.079722412],[-558332.583400074,5036315.728522423],[-559259.5792000741,5035495.060721424],[-559021.6581000738,5035017.196820855],[-563261.2400000804,5032809.654818108],[-565057.1709000904,5032925.277218214],[-565896.9519000943,5033435.038618804],[-567743.8069000989,5034062.911019513],[-567986.756900103,5033409.9248187225],[-569003.2351001017,5032276.206317336],[-569175.2576000994,5032479.704617585],[-570405.8546001059,5032363.1172174],[-570504.474400104,5031837.517616774],[-570907.5263001039,5031887.541216822],[-570878.8926001106,5032073.289517047],[-571330.807900109,5032440.277317478],[-571269.7784001105,5032548.278317607],[-571786.7121001082,5033186.598018364],[-571755.8366001117,5033605.428818869],[-572428.0941001145,5034082.836619429],[-572747.8873001132,5034141.509819487],[-572807.3071001153,5034346.434519728],[-573136.9614001152,5034482.082519883],[-573148.370000115,5034676.210320126],[-574418.4676001214,5035558.186021145],[-574590.4724001171,5035485.983621061],[-575086.3491001251,5036008.971121664],[-576024.1626001225,5036161.296121831],[-576029.031700127,5036463.496222197],[-576402.4611001253,5036434.152722148],[-576479.4741001299,5036649.305522408],[-576261.6450001255,5036746.669522538],[-576596.9105001319,5037048.589222879],[-576817.7183001307,5036857.895722651],[-577198.5212001293,5036964.188322759],[-577888.6292001329,5036282.170921923],[-578457.7164001336,5036436.915222091],[-578917.1391001337,5036924.7144226665],[-579655.8075001421,5036699.492322376],[-579743.8622001385,5036980.948122708],[-580889.5655001451,5035908.869921386],[-581355.6157001448,5036288.486021825],[-580792.1313001398,5037087.388822798],[-581340.8114001447,5037531.523023316],[-581599.5065001426,5038414.695424377],[-581490.3997001468,5038663.931424669],[-581723.5106001497,5038697.916324708],[-581587.5462001452,5038830.61912487],[-581637.9908001495,5039143.725525243],[-582019.1038001461,5039412.362025559],[-581935.1950001488,5039920.785026169],[-582158.953800149,5040158.846426449],[-582054.8737001499,5040293.421426613],[-582156.6680001478,5040485.333726835],[-582284.8268001499,5040410.090326738],[-582713.6886001511,5040726.805227107],[-582729.3812001509,5040872.961727286],[-583183.5023001529,5040982.493827401],[-583592.7531001569,5041463.587227973],[-583799.9181001537,5041311.655427783],[-584277.9544001569,5041317.911527772],[-584181.9972001609,5041612.225828127],[-584757.70080016,5041853.11692839],[-585052.1843001612,5041536.307428006],[-586005.1973001612,5041480.800127908],[-586500.0371001688,5041775.663228244],[-586864.1181001678,5041584.900028001],[-586616.7802001733,5041262.253927622],[-586720.4351001718,5041215.564027559],[-587096.1106001699,5041470.873427849],[-587562.8318001752,5041246.747027572],[-587646.5289001735,5041401.775927759],[-588051.560700176,5041153.939727449],[-588083.7365001758,5041318.313427638],[-588709.4979001823,5041237.846027525],[-589091.410600182,5040009.9488260355],[-588926.2827001815,5039887.7487258995],[-589056.8688001811,5039503.264625427],[-588740.2813001812,5039222.5428251065],[-589656.7966001829,5039101.043624923],[-590187.0241001862,5039731.7678256575],[-590815.6182001916,5039411.286625251],[-590933.0695001887,5039586.686625462],[-592996.4739002006,5038576.309624168],[-593362.7262002059,5038575.796424153],[-593612.1219002045,5038671.653824256],[-593089.1128002023,5039163.960524867],[-593292.4206002065,5039571.490425348],[-594287.8688002054,5040168.179526028],[-594019.4914002077,5040405.913926322],[-594479.1262002125,5041014.397727034],[-593316.1853001993,5042500.883428862],[-591705.7422001897,5043648.908530301],[-591241.7831001957,5044329.063331128],[-591115.0512001918,5044808.293531704],[-591276.9100001946,5045053.24103199],[-590926.3907001896,5045155.903832124],[-590841.3458001891,5045555.417532608],[-590517.5273001839,5045814.659632923],[-590295.4427001827,5045451.306832508],[-589286.6136001826,5045771.3624329185],[-589771.8851001831,5045741.165232862],[-589487.1611001843,5046225.970633454],[-589745.3822001843,5046297.785233532],[-589827.360800185,5046586.238633876],[-589648.6449001812,5047213.608134634],[-589402.7417001816,5047257.46313469],[-589462.3211001805,5047451.86993492],[-589636.8958001799,5047423.245334885],[-589432.8513001807,5047896.665535462],[-589690.2152001819,5048337.858735979],[-589904.5439001865,5049967.09773791],[-590239.0494001859,5050659.738838722],[-590162.5604001851,5051184.619339351],[-589073.8681001746,5052128.567240509],[-589611.3792001811,5052354.418940756],[-589431.5833001786,5054105.550342841],[-589689.2178001788,5055558.46174456],[-590402.4911001846,5056741.86514594],[-590354.2504001829,5057933.679847353],[-590713.9505001849,5058411.275947905],[-590384.0768001869,5059060.805748694],[-590644.3869001832,5059499.7320492035],[-591079.6511001858,5059464.0819491455],[-591766.1087001918,5059722.052049414],[-592455.7115001911,5060595.360750417],[-592712.3250001969,5062683.471952878],[-593681.0729001978,5065321.841355964],[-593847.6857002018,5067166.213058127],[-593786.753200198,5068218.0202593645],[-593538.4531001975,5069134.702560455],[-592475.5691001944,5070658.787762289],[-592274.0165001921,5071737.484463567],[-591231.8733001887,5072808.107764865],[-590832.2712001811,5073607.551565817],[-592036.5771001874,5074616.765066953],[-594361.2438001971,5075321.486967683],[-593697.6612002002,5076901.378869561],[-593649.1881001929,5078072.951370937],[-593024.5483001932,5078531.236071499],[-593580.1461001926,5078975.020971996],[-592753.0449001932,5079738.456472923],[-593247.9594001892,5080352.52637362],[-593763.7748001916,5080353.283973602],[-594166.8514001948,5080621.975673895],[-594973.330100203,5083290.90907697],[-594684.1451001986,5083591.848877336],[-594017.8695001965,5082762.844976398],[-593611.0626001956,5082755.132276404],[-593576.2247001966,5083095.979876804],[-593180.8074001935,5083116.04437684],[-592316.8907001918,5083663.9548775125],[-591466.688700186,5084529.999678567],[-590254.4849001766,5086182.113680531],[-589574.6533001745,5086546.983580981],[-588835.3663001698,5086530.528880986],[-587450.3593001624,5087318.305181949],[-586675.8446001569,5087028.160081649],[-586527.7436001613,5087179.334481821],[-585750.1121001542,5086921.328481558],[-585268.0443001555,5087513.677082259],[-584120.8386001444,5088435.4172833655],[-583500.6129001467,5089315.26898441],[-582628.2456001404,5089008.540784084],[-582370.9837001425,5089379.448884528],[-582075.5038001392,5090600.406785953],[-582551.5226001411,5090951.014786334],[-582612.484400144,5091453.029586922],[-583256.0037001427,5092396.696087992],[-584104.6998001502,5093013.533388684],[-584180.9121001466,5093327.696489038],[-585253.8614001519,5093375.957289057],[-585196.4144001541,5093527.512189237],[-585986.9082001579,5094053.331389822],[-586680.9360001566,5094001.549489732],[-586948.8492001576,5093835.04488953],[-587118.7731001601,5094207.022789962],[-586876.859600158,5094856.522490721],[-586945.2730001583,5095174.948591089],[-587823.1920001644,5095615.327791561],[-587693.9192001629,5095928.289491926],[-588094.2157001654,5096326.377892374],[-588123.5692001681,5096578.8760926565],[-588624.3282001709,5096836.26759294],[-589222.2532001699,5097434.134793611],[-587868.6764001593,5098967.285195437],[-586426.0200001535,5099766.862096403],[-586255.4201001569,5100188.278096894],[-586733.6798001607,5100345.907797059],[-586860.9301001593,5100665.647397425],[-586668.166800155,5101056.85009788],[-586713.6844001546,5101417.647598298],[-587485.1491001587,5102004.615798944],[-589156.5975001651,5102572.942999527],[-589366.5798001704,5102481.518499421],[-589712.0438001709,5102662.696899624],[-590631.8602001738,5102489.216799381],[-590948.4316001775,5102988.931199948],[-591787.4817001793,5102792.018699686],[-591949.2676001816,5102947.228199859],[-592243.6219001828,5102864.187599756],[-593209.743000185,5103618.512400582],[-592688.094300188,5104989.898102179],[-592805.6901001843,5105736.505803041],[-592599.9645001839,5106336.312503734],[-592417.2631001811,5106350.639203755],[-592408.208700183,5106611.131304059],[-592165.3234001829,5106723.67020419],[-592749.1207001834,5107710.027705302],[-592544.3405001806,5108496.427406206],[-592712.6045001853,5108639.4646063605],[-592696.5734001821,5109834.138907729],[-592482.2874001826,5110567.291808587],[-593038.2856001811,5113243.345311621],[-593130.3122001817,5113432.819911836],[-593560.4687001844,5113613.099012026],[-593553.938400189,5113867.000712309],[-594269.8581001897,5114177.768412645],[-594593.2887001921,5115551.835014199],[-594537.5712001881,5116013.91581472],[-594766.3047001874,5116210.425614939],[-595080.4658001908,5116448.915315193],[-596464.9681002041,5116100.749514741],[-596245.2266001963,5118689.312417702],[-596523.1852001976,5119116.852618172],[-596690.3916002013,5120192.237719383],[-596860.6660002021,5120448.162719668],[-597291.2668002051,5120533.008519751],[-597788.661600209,5120174.018419322],[-597950.1498002075,5119328.657518357],[-598363.9764002063,5119096.912118074],[-598404.5037002073,5120327.575319467],[-598576.8187002119,5120461.161219614],[-598678.8697002126,5121105.860820334],[-599386.8434002186,5122315.530521684],[-600089.0616002202,5123987.739423551],[-600166.0518002226,5125172.301224893],[-599133.1306002125,5126414.83042634],[-597950.3601002073,5127380.59282748],[-597805.4116002051,5127759.683427925],[-597235.6156002036,5127983.825028196],[-595503.2527001958,5128211.683828526],[-595082.5580001909,5128996.31232943],[-594617.9909001854,5129450.051629973],[-593924.9943001866,5129335.873929866],[-593905.6921001876,5129464.136930015],[-593237.2968001787,5129417.806229992],[-592922.0419001793,5129550.091830157],[-592514.9501001794,5129307.004029896],[-592263.5653001781,5129623.089630258],[-591814.7422001695,5129721.305130395],[-590681.1843001693,5130916.47193179],[-589480.6293001623,5131669.605532672],[-587612.3496001542,5133277.0917345695],[-587412.4218001518,5134486.4002359435],[-588562.6548001587,5135202.422436693],[-588940.3563001597,5134989.153636441],[-589429.3982001648,5135183.237736643],[-589815.3547001616,5134878.233136282],[-589985.3548001681,5135020.315136439],[-590275.3191001688,5134886.04483628],[-590458.0236001667,5135051.99303646],[-590648.3133001635,5134949.994036325],[-590706.47030017,5135069.508536466],[-590854.9489001698,5134908.092336276],[-592947.4271001748,5135409.755536756],[-593380.6633001829,5135816.400737197],[-593016.9642001776,5136347.030437812],[-592219.6712001772,5137007.870338586],[-592418.2391001772,5137162.6183387535],[-590713.9479001684,5139708.0396416765],[-591045.3836001676,5140615.783542687],[-590587.3557001649,5141091.248943235],[-591093.2160001682,5142399.68624468],[-591274.8863001679,5143370.978845766],[-591224.8109001693,5144754.01544731],[-590724.4910001691,5146061.857548789],[-589538.4928001594,5147681.992450643],[-589295.6359001582,5148994.01295212],[-589863.9924001641,5149315.5696524605],[-591032.5338001666,5150589.747153823],[-591094.2255001677,5150837.381354102],[-592317.0908001716,5151623.584354924],[-593913.4349001802,5151617.776754854],[-593862.4312001795,5152014.064755299],[-593495.1040001763,5152382.618955727],[-591373.0229001652,5153416.238756963],[-590623.8199001628,5154024.249257666],[-589953.8505001588,5155186.903858982],[-588707.099300153,5156187.15676014],[-588749.2177001534,5156709.208560717],[-588357.9893001554,5157102.658061161],[-586590.3521001446,5158135.664862372],[-585912.6504001431,5158269.665262552],[-584917.2157001429,5158124.74926243],[-585596.7898001447,5158674.550663015],[-587839.2157001497,5157804.297761963],[-590191.0701001588,5159680.569363949],[-590352.7625001598,5159646.525163906],[-590242.6244001593,5159899.045964198],[-590931.404100166,5161225.346465641],[-591047.7397001657,5161402.97036582],[-591477.0322001654,5161372.438665771],[-591979.7659001721,5161971.293066412],[-592588.6026001727,5163805.952368415],[-592834.1224001695,5164035.4077686565],[-593560.5482001738,5164000.709268594],[-595441.9777001846,5164363.322068911],[-597947.8280001954,5166296.759870934],[-598497.6282001986,5166919.913471588],[-598486.360400196,5167192.899171888],[-598279.6921001947,5167452.447272185],[-598412.9115001966,5167988.726472762],[-597918.405400192,5168686.988473556],[-598134.9182001947,5170580.757575629],[-598681.130900196,5172229.335577417],[-599876.2307002016,5173828.893079109],[-600025.2247002058,5174442.064079769],[-598497.5761001942,5175898.024281436],[-598590.9478001931,5176449.403082031],[-598866.9512002018,5176547.073382126],[-598952.4332002,5177443.291883111],[-598898.9223001952,5177892.094283592],[-598631.3427001939,5177904.985283621],[-598671.8695001985,5178103.860383837],[-598089.660400191,5178716.132184536],[-598370.5987001988,5179184.041885031],[-598363.060400197,5179980.381285904],[-598051.9524001891,5180174.245086133],[-597955.4354001919,5180482.436686469],[-598475.6562001908,5181660.256587723],[-598298.7559001906,5181740.908787823],[-598441.4271001931,5182270.959588396],[-598925.5995001955,5182969.965489126],[-599060.9062001958,5184879.626991202],[-598853.8694001933,5185477.795591857],[-599460.2899001975,5186011.267092409],[-599886.9339002004,5186860.909593308],[-599690.8339001999,5189396.272996072],[-598924.1282001917,5190668.086997482],[-599846.3771001959,5191780.311498639],[-599800.9345001975,5194208.508201267],[-598990.7359001931,5194803.90650195],[-598241.6203001869,5194348.368501498],[-597596.2159001863,5194420.544501601],[-596809.9807001872,5194766.003802002],[-595888.5654001824,5193877.814601094],[-595466.0734001774,5194061.43720131],[-594562.7933001696,5193631.556400887],[-594506.323300174,5193440.900800672],[-593961.8297001708,5193503.276300773],[-594157.3959001716,5193010.604800225],[-593568.4294001666,5192282.3707994735],[-592977.0633001633,5192007.610799194],[-592702.2351001656,5192215.447999435],[-591923.2127001596,5191781.995198995],[-591338.4858001643,5190952.109298119],[-590824.0657001558,5190875.4287980655],[-590717.7095001591,5190931.098198123],[-590894.2874001593,5191079.223498281],[-590907.1925001532,5191357.64929858],[-590642.3641001576,5191887.243899159],[-590669.1797001533,5192231.641999529],[-589969.9119001522,5193306.361400727],[-589976.6712001504,5193958.631101422],[-590202.0700001522,5194315.317501808],[-589919.470400156,5194389.3147018915],[-589657.9699001537,5194797.117602346],[-588537.9279001472,5195483.988803133],[-587399.2129001429,5193450.103700969],[-587206.470000138,5193302.31530082],[-587055.7841001393,5193417.347400955],[-586168.9176001364,5192623.510300121],[-585223.0435001306,5192602.689600138],[-584779.8030001284,5192925.780100503],[-584338.4876001292,5192964.5500005605],[-583950.8727001294,5193199.509600827],[-583804.6477001322,5193074.780100702],[-583479.3645001276,5193167.301800807],[-582503.1026001238,5193895.5669016335],[-582314.7144001244,5194584.161402376],[-581998.5303001219,5194614.132502424],[-581755.054900123,5195002.286602849],[-582148.0585001231,5195693.296803587],[-582830.7830001226,5195544.001203396],[-583598.5169001254,5195756.619403603],[-583849.7234001277,5196024.8307038825],[-583837.3901001298,5196274.300504149],[-584605.8349001289,5196408.300304275],[-584872.7764001293,5196964.505204853],[-584410.1154001325,5197839.40630582],[-584259.7717001261,5197817.659605796],[-583986.779600129,5198622.570006672],[-583836.0057001271,5200587.8712087935],[-583171.6364001227,5200935.970309192],[-582800.3995001265,5201707.130010033],[-582924.5213001213,5202014.111310358],[-582234.329700123,5202360.167510752],[-582380.5718001222,5200672.3426089315],[-582028.6889001202,5200376.808308638],[-581122.7884001198,5202702.322411158],[-580718.0653001114,5202712.912111181],[-580324.6975001136,5202431.881810895],[-579643.4565001143,5201405.069009809],[-578895.4316001098,5200714.640109096],[-578977.7928001103,5200610.907008979],[-578628.2594001082,5200087.608208424],[-576937.8150001046,5200639.250009075],[-577022.7529001063,5201216.862809695],[-576429.7802001027,5201676.475410203],[-575097.5661001003,5201785.112910366],[-574880.0901000998,5201672.7993102465],[-573978.3488000944,5202098.154510729],[-573975.2686000927,5202671.347911349],[-572662.7230000906,5203247.985412],[-571021.9083000874,5205502.347514464],[-571029.4305000863,5205695.978514668],[-570651.1178000874,5206175.791715184],[-570327.3721000855,5206299.123015338],[-570332.6584000845,5206566.01941562],[-569909.0438000815,5207182.54671629],[-569264.2161000823,5207486.038216624],[-569065.4965000806,5207806.8582169805]]]]);

        // generate a GetFeature request
        var featureRequest = new ol.format.WFS().writeGetFeature({
          srsName: 'EPSG:3857',
          featureNS: 'http://visorsiu.fomento.es',
          featurePrefix: 's',
          featureTypes: ['su'],
          outputFormat: 'text/xml; subtype=gml/3.1.1',
          filter: ol.format.filter.and(
            ol.format.filter.notEqualTo('clasesuelo', 'SUELO NO URBANIZABLE'),
            ol.format.filter.intersects('the_geom', geom,'EPSG:3857')
            
          )
        });

        // then post the request and add the received features to a layer
        fetch('http://visorsiu.fomento.es/geoserver/wfs', {
          method: 'POST',
          mode: 'no-cors',                    
          headers:{
            'Access-Control-Allow-Headers': '*',
            'Access-Control-Allow-Methods': '*',
            'Access-Control-Allow-Credentials':'true',
            'Access-Control-Allow-Origin':		'chrome-extension://aejoelaoggembcahagimdiliamlcdmfm'
                },
                    
		
          body: new XMLSerializer().serializeToString(featureRequest)
        }).then(function(response) {
          console.log(response);
          return response.json();
        }).then(function(json) {
          var features = new ol.format.GeoJSON().readFeatures(json);
          vectorSource.addFeatures(features);
          map.addLayer(vector);
          add_layer_to_list(vector);
        });
        console.log(features);
        return features;
  }

  function getWPSRequest(feature1,feature2){

    return `<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">
    <ows:Identifier>gs:IntersectionFeatureCollection</ows:Identifier>
    <wps:DataInputs>
      <wps:Input>
        <ows:Identifier>first feature collection</ows:Identifier>
        <wps:Reference mimeType="text/xml; subtype=wfs-collection/1.1" xlink:href="http://localhost:8081/geoserver/wfs" method="POST">
          <wps:Body><![CDATA[`+feature1+`]]></wps:Body>
        </wps:Reference>
      </wps:Input>
      <wps:Input>
        <ows:Identifier>second feature collection</ows:Identifier>
        <wps:Reference mimeType="text/xml; subtype=wfs-collection/1.1" xlink:href="http://localhost:8081/geoserver/wfs" method="POST">
          <wps:Body><![CDATA[`+feature2+`]]></wps:Body>
        </wps:Reference>
      </wps:Input>
    </wps:DataInputs>
    <wps:ResponseForm>
      <wps:RawDataOutput mimeType="text/xml; subtype=wfs-collection/1.1">
        <ows:Identifier>result</ows:Identifier>
      </wps:RawDataOutput>
    </wps:ResponseForm>
  </wps:Execute>`;
  }

function getWPSTransform(feauture){
    return `<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">
    <ows:Identifier>gs:CollectGeometries</ows:Identifier>
    <wps:DataInputs>
      <wps:Input>
        <ows:Identifier>features</ows:Identifier>
        <wps:Data>
          <wps:ComplexData mimeType="text/xml; subtype=wfs-collection/1.1"><![CDATA[`+feature+`]]></wps:ComplexData>
        </wps:Data>
      </wps:Input>
    </wps:DataInputs>
    <wps:ResponseForm>
      <wps:RawDataOutput mimeType="text/xml; subtype=gml/3.1.1">
        <ows:Identifier>result</ows:Identifier>
      </wps:RawDataOutput>
    </wps:ResponseForm>
  </wps:Execute>`;
}

  function readFeaturesFromWPSResponse(response,featureNSUri,featureName){
              //var cleaned= response.replace(/<gml\:posList/g,'<gml:posList dimension="2"');
              var gml=new ol.format.GML({uri:featureNSUri,
                                              featureName:featureName});
      // Parche para que se pueda buscar en Features que no sean del espacio de nombres gmlns        				
              gml.read = function (data){
              if(typeof data == "string") { 
                  data = ol.format.XML.prototype.read.apply(this, [data]);
              }
              var featureMembers = this.getElementsByTagNameNS(data.documentElement,this.gmlns,"featureMembers");

              var featureNodes = this.getElementsByTagNameNS(data.documentElement,
                                                            this.uri,
                                                            this.featureName);

              var featureNodes = featureMembers[0].childNodes;
              var features = [];
              for(var i=0; i<featureNodes.length; i++) {
                  var feature = this.parseFeature(featureNodes[i]);
                  if(feature) {
                      features.push(feature);
                  }
              }            
              return features;
          };
          return gml.read(response);
      }




  









/****************************************************************************************/

  /**
   * @param {*} cdemo 
   * @param {*} cvalue 
   * @param {*} exdays 
   */
  function setCookie(cdemo, cvalue, exdays) {
      var d = new Date();
      d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
      var expires = "expires=" + d.toGMTString();
      document.cookie = cdemo + "=" + cvalue + "; " + expires;
  }
  function getCookie(cdemo) {
      var demo = cdemo + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') c = c.substring(1);
          if (c.indexOf(demo) == 0) {
              return c.substring(demo.length, c.length);
          }
      }
      return "";
  }
  function checkCookie(cookiename, redirect) {
      var demo = getCookie(cookiename);
      if (demo == "false") {
          document.location.href = redirect;
      }
      setCookie(cookiename, false, 1000);
  }