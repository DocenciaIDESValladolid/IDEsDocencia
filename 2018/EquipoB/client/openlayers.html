<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>InvasionX - Test OpenLayers</title>
    <link rel="stylesheet" href="css/ol.css">
    <!--<script src="ol/ol.js"></script>-->
    <script src="js/lib/ol-debug.js"></script>
    <script src="js/lib/jquery-3.3.1.min.js"></script>
</head>

<body>
    <div id="map" class="map"></div>
    <script>
        /** 
            WFS GetFeature
        **/
        /*
            var buildingsMontpellierSource = new ol.source.Vector();
            var buildingsMontpellier = new ol.layer.Vector({
                source: buildingsMontpellierSource,
                style: new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: 'rgba(0, 0, 255, 1.0)'
                    })
                })
            });
        */

        /*
         * WMS
         */
        var extendMontpellier = [3.437551906747534, 43.30025132468639, 4.196530215452023, 43.8832647050586];
        
        var dataMontpellierRasterSource = new ol.source.ImageWMS({
            url: 'http://localhost/geoserver/invasionx/wms',
            params: {
                'LAYERS': 'invasionx:PopMontpellier,invasionx:DechetMontpellier,invasionx:CimetiereMontpellier'
            },
            //projection: 'EPSG:3857',
            serverType: 'geoserver'
        });

        var dataMontpellierRaster = new ol.layer.Image({
            extent: ol.proj.transformExtent(extendMontpellier,'EPSG:4326','EPSG:3857'),
            source: dataMontpellierRasterSource
        });
        
        var openStreetMap = new ol.layer.Tile({
            source: new ol.source.OSM({
                attributions: [
                    'All maps Â© <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
                    ol.source.OSM.ATTRIBUTION
                ]
            })
        });

        var map = new ol.Map({
            layers: [
                openStreetMap,
                dataMontpellierRaster
            ],
            target: 'map',
            controls: ol.control.defaults({
                attributionOptions: {
                    collapsible: false
                }
            }),
            view: new ol.View({
                minZoom: 10,
                maxZoom: 14,
                center: ol.proj.fromLonLat([3.8802, 43.6102]),
                zoom: 10
            })
        });
        /**
        // generate a GetFeature request
        var featureRequest = new ol.format.WFS().writeGetFeature({
            srsName: 'EPSG:3857',
            featureNS: 'invasionx',
            featurePrefix: 'invasionx',
            featureTypes: ['PopMontpellier'],
            maxFeatures: 20,
            outputFormat: 'application/json'
        });

        // then post the request and add the received features to a layer
        fetch('http://localhost/geoserver/wfs', {
            method: 'POST',
            body: new XMLSerializer().serializeToString(featureRequest)
        }).then(function (response) {
            return response.json();
        }).then(function (json) {
            var features = new ol.format.GeoJSON().readFeatures(json);
            buildingsMontpellierSource.addFeatures(features);
            map.getView().fit(buildingsMontpellierSource.getExtent());
        });
        **/
        /*
            Link of OpenStreetMap's API:
                Prod 
                https://api.openstreetmap.org/
                Dev
                https://master.apis.dev.openstreetmap.org/

            Documentation of the API:
                https://wiki.openstreetmap.org/wiki/API_v0.6
            Anchor to the call we want to do:
                https://wiki.openstreetmap.org/wiki/API_v0.6#Retrieving_map_data_by_bounding_box:_GET_.2Fapi.2F0.6.2Fmap
                GET /api/0.6/map?bbox=left,bottom,right,top
                For Montpellier:
                    3.7003,43.5361,4.0478,43.6838

            Basic Authentification:
                https://en.wikipedia.org/wiki/Basic_access_authentication

            Enable CORS
                http://docs.geoserver.org/latest/en/user/production/container.html#enable-cors
        
        http://localhost:8080/geoserver/wfs?service=wfs&version=2.0.0&request=GetFeature&typeNames=invasionx:PopMontpellier&count=5
                */
    </script>
</body>

</html>